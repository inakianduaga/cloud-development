# Cloud development frontend proxy container

description "Cloud development frontend proxy docker container daemon"
instance $CERTIFICATES_PATH/$BASE_HOSTNAME/$USERS_CONFIG_PATH

console log
respawn

script

  function getDockerBridgeIp()
  {
      echo $(ip route | awk '/docker0/ { print $NF }')
  }

  exec docker run \
       -p 80:80 -p 443:443 \
       -v $CERTIFICATES_PATH:/etc/nginx/certs \
       -e BASE_HOSTNAME=$BASE_HOSTNAME \
       --env-file $USERS_CONFIG_PATH \
       -e PROXY_HOST=$(getDockerBridgeIp)
       --name cloud_frontend_proxy cloud_frontend_proxy

end script

